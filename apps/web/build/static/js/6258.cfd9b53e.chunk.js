(self.webpackChunk_uniswap_interface=self.webpackChunk_uniswap_interface||[]).push([[6258],{22550:(e,t,o)=>{var r=o(62336);t.d=function(e){var t=e.params,o=(0,i.default)(e,u),r=[a.TRADING_API_CACHE_KEY,c.uniswapUrls.tradingApiPaths.migrate,t];return(0,s.useQuery)(Object.assign({queryKey:r,queryFn:t?(0,n.default)((function*(){return yield(0,a.migrateLpPosition)(t)})):s.skipToken},o))};var n=r(o(38203)),i=r(o(44725)),s=o(15396),c=o(95020),a=o(91128),u=["params"]},26597:(e,t,o)=>{t.b=function(e){return(0,r.useQuery)(n.getPosition,e,{transport:i.uniswapGetTransport,enabled:!!e})};var r=o(59260),n=o(74357),i=o(53769)},7986:(e,t,o)=>{"use strict";o.d(t,{R:()=>g});var r=o(95682),n=o(33962),i=o(35480),s=o(4163),c=o(79253),a=o(67579),u=o(14021),d=o(78605),l=o(77845),p=o(10751),y=o(17544),m=o(96432);function g({title:e,closeModal:t,goBack:o}){const{t:g}=(0,i.useTranslation)(),x=(0,n.useMemo)((()=>(0,r.jsx)(s.US,{"data-testid":"LiquidityModalHeader-close",onClick:t,size:l.iconSizes.icon24})),[t]);return(0,r.jsxs)(c.s,{row:!0,justifyContent:"space-between",alignItems:"center",gap:"$spacing4",width:"100%",children:[o?(0,r.jsx)(a.l,{onPress:o,children:(0,r.jsx)(d.BackArrow,{color:"$neutral1",size:"$icon.24"})}):x,(0,r.jsx)(u.EY,{variant:"body2",flexGrow:1,textAlign:"center",pr:24,children:e}),o?(0,r.jsx)(c.s,{position:"absolute",top:"0",right:"0",p:"$spacing4",children:x}):(0,r.jsx)(p.SwapFormSettings,{adjustTopAlignment:!1,settings:[m.Slippage,y.B],defaultTitle:g("pool.positions.transaction.settings")})]})}},76175:(e,t,o)=>{"use strict";o.d(t,{Y:()=>l});var r=o(95682),n=o(8509),i=o(79253),s=o(14021),c=o(77845),a=o(2473),u=o(28709),d=o(15889);function l({currencyAmount:e,currencyUSDAmount:t}){var o,l;const{formatCurrencyAmount:p}=(0,a.useLocalizationContext)();return(0,r.jsxs)(i.s,{row:!0,alignItems:"center",children:[(0,r.jsxs)(i.s,{grow:!0,children:[(0,r.jsxs)(s.EY,{variant:"heading2",children:[p({value:e,type:d.NumberType.TokenNonTx})," ",(0,u.getSymbolDisplayText)(null===(o=e)||void 0===o?void 0:o.currency.symbol)]}),(0,r.jsx)(s.EY,{variant:"body3",color:"$neutral2",children:p({value:t,type:d.NumberType.FiatStandard})})]}),(0,r.jsx)(n.A,{currency:null===(l=e)||void 0===l?void 0:l.currency,size:c.iconSizes.icon36})]})}},36258:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>ue});var r=o(95682),n=o(58793),i=o(55282),s=o(7986),c=o(96480),a=o(76175),u=o(88024),d=o(22161),l=o(12520),p=o(17376),y=o(87873),m=o(6692),g=o(28438),x=o(43442),v=o(33962),h=o(36220),j=o(22550),f=o(35821),A=o(76234),k=o(35334),T=o(36093),I=o(85559);const S=(0,v.createContext)(void 0);function P({children:e,positionInfo:t}){var o,i;const s=(0,I.F)(),{derivedPositionInfo:c,positionState:a}=(0,x.o)(),{feeValue0:u,feeValue1:d}=(0,m.GS)(t),{derivedPriceRangeInfo:l,priceRangeState:{fullRange:p}}=(0,x.DL)(),y=(0,v.useMemo)((()=>{if(t&&s.address)return{simulateTransaction:!0,walletAddress:s.address,chainId:t.currency0Amount.currency.chainId,protocol:f.ProtocolItems.V3,positionToken:t.tokenId}}),[t,s.address]),{data:P,error:C,refetch:w}=(0,h.P)({params:y,headers:{"x-universal-router-version":"2.0"},staleTime:5*T.ONE_SECOND_MS}),b=(0,v.useMemo)((()=>{var e,o,r,i,y,m,x,v;if(!c||!t||!t.tokenId||!(null===(e=s)||void 0===e?void 0:e.address)||!l||c.protocolVersion!==n.ProtocolVersion.V4||l.protocolVersion!==n.ProtocolVersion.V4||!t.pool||!t.liquidity)return;const h=c.pool??l.mockPool;if(!h)return;const j=p?l.tickSpaceLimits[0]:null===(o=l.ticks)||void 0===o?void 0:o[0],A=p?l.tickSpaceLimits[1]:null===(r=l.ticks)||void 0===r?void 0:r[1];return j&&A&&t.pool&&t.liquidity?{inputProtocol:f.ProtocolItems.V3,tokenId:Number(t.tokenId),inputPosition:{pool:{token0:t.currency0Amount.currency.isNative?g.cF:t.currency0Amount.currency.address,token1:t.currency1Amount.currency.isNative?g.cF:t.currency1Amount.currency.address,fee:t.feeTier?Number(t.feeTier):void 0,tickSpacing:(null===(i=t)||void 0===i?void 0:i.tickSpacing)?Number(null===(y=t)||void 0===y?void 0:y.tickSpacing):void 0},tickLower:t.tickLower?Number(t.tickLower):void 0,tickUpper:t.tickUpper?Number(t.tickUpper):void 0},inputPoolLiquidity:t.pool.liquidity.toString(),inputCurrentTick:t.pool.tickCurrent,inputSqrtRatioX96:null===(m=t.pool.sqrtRatioX96)||void 0===m?void 0:m.toString(),inputPositionLiquidity:t.liquidity,outputProtocol:f.ProtocolItems.V4,outputPosition:{pool:{token0:t.currency0Amount.currency.isNative?g.cF:t.currency0Amount.currency.address,token1:t.currency1Amount.currency.isNative?g.cF:t.currency1Amount.currency.address,fee:a.fee.feeAmount,hooks:a.hook,tickSpacing:h.tickSpacing},tickLower:j,tickUpper:A},outputPoolLiquidity:c.creatingPoolOrPair?void 0:h.liquidity.toString(),outputSqrtRatioX96:c.creatingPoolOrPair?void 0:h.sqrtRatioX96.toString(),outputCurrentTick:c.creatingPoolOrPair?void 0:h.tickCurrent,initialPrice:c.creatingPoolOrPair?h.sqrtRatioX96.toString():void 0,chainId:t.currency0Amount.currency.chainId,walletAddress:s.address,expectedTokenOwed0RawAmount:(null===(x=u)||void 0===x?void 0:x.quotient.toString())??"0",expectedTokenOwed1RawAmount:(null===(v=d)||void 0===v?void 0:v.quotient.toString())??"0",amount0:t.currency0Amount.quotient.toString(),amount1:t.currency1Amount.quotient.toString()}:void 0}),[c,t,s,l,p,a.fee.feeAmount,a.hook,null===(o=u)||void 0===o?void 0:o.quotient,null===(i=d)||void 0===i?void 0:i.quotient]),{data:E,error:q,refetch:R}=(0,j.d)({params:b,staleTime:5*T.ONE_SECOND_MS}),N=(0,v.useMemo)((()=>{var e,o,r;if(!E)return;const i=(0,k.validatePermit)(null===(e=P)||void 0===e?void 0:e.permitData);if((null===(o=P)||void 0===o?void 0:o.permitData)&&!i)return;const s=(0,k.validateTransactionRequest)(E.migrate);return s?{type:A.LiquidityTransactionType.Migrate,unsigned:Boolean(null===(r=P)||void 0===r?void 0:r.permitData),migratePositionRequestArgs:b,approveToken0Request:void 0,approveToken1Request:void 0,permit:i,protocolVersion:n.ProtocolVersion.V3,approvePositionTokenRequest:void 0,revocationTxRequest:void 0,txRequest:s,action:{type:A.LiquidityTransactionType.Migrate,currency0Amount:t.currency0Amount,currency1Amount:t.currency1Amount}}:void 0}),[E,b,P,t.currency0Amount,t.currency1Amount]);return(0,r.jsx)(S.Provider,{value:{txInfo:N,error:Boolean(C||q),refetch:C?w:q?R:void 0},children:e})}var C=o(61033),w=o(5407),b=o(60836),E=o(69646),q=o(98145),R=o(73645),N=o(11302),F=o(46192),O=o(35480),V=o(61550),L=o(88361),$=o(18989),_=o(4163),D=o(66249),M=o(84840),U=o(42929),K=o(82291),z=o(79253),Y=o(14021),B=o(53745),G=o(1406),W=o(14584),X=o(32753),H=o(72817),Q=o(26597),Z=o(55e3),J=o(34546),ee=o(45805),te=o(53195),oe=o(52942),re=o(88438),ne=o(93280),ie=o(20722),se=o(46739);const ce=(0,M.I)(U.gZ,{backgroundColor:"$surface1",display:"flex",flexDirection:"row",gap:60,mt:"1rem",mx:"auto",width:"100%",zIndex:"$default",p:24});function ae({positionInfo:e}){const{chainName:t,tokenId:o}=(0,L.g)(),n=(0,ie.useTrace)(),{t:d}=(0,O.useTranslation)(),{positionState:l,setPositionState:m,setStep:g,step:h}=(0,x.o)(),{protocolVersion:j}=l,{setPriceRangeState:f}=(0,x.DL)(),{setDepositState:k}=(0,x.r5)(),{value:T,isLoading:P}=(0,ee.useFeatureFlagWithLoading)(J.FeatureFlags.LPRedesign),[C,N]=(0,v.useState)([]),[M,U]=(0,v.useState)(),Q=(0,y.A)(),te=(0,I.F)().chainId,ne=(0,H.useAccountMeta)(),se=(0,V.useDispatch)(),{txInfo:ce,error:ae,refetch:ue}=function(){const e=(0,v.useContext)(S);if(!e)throw new Error("useMigrateV3TxContext must be used within a MigrateV3PositionTxContextProvider");return e}(),de=(0,K.Qf)(),le=(0,L.Zp)(),pe=()=>{U(void 0)},{currency0Amount:ye,currency1Amount:me}=e,ge=(0,re.useUSDCValue)(ye)??void 0,xe=(0,re.useUSDCValue)(me)??void 0;return P||T?P?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(z.s,{mt:"$spacing48",gap:"$gap36",children:[(0,r.jsxs)(i.AF,{"aria-label":"breadcrumb-nav",children:[(0,r.jsxs)(i.TV,{to:"/positions",children:[(0,r.jsx)(O.Trans,{i18nKey:"pool.positions.title"})," ",(0,r.jsx)(F.A,{size:14})]}),(0,r.jsxs)(i.TV,{to:`/positions/v3/${t}/${o}`,children:[ye.currency.symbol," / ",me.currency.symbol," ",(0,r.jsx)(F.A,{size:14})]})]}),(0,r.jsxs)(z.s,{row:!0,justifyContent:"space-between",alignItems:"center",gap:"$gap20",width:"100%",children:[(0,r.jsx)(Y.EY,{width:"100%",variant:"heading2",children:(0,r.jsx)(O.Trans,{i18nKey:"common.migrate.position"})}),(0,r.jsxs)(z.s,{row:!0,backgroundColor:"$surface2",borderRadius:"$rounded12",alignItems:"center",justifyContent:"center",gap:"$gap4",py:"$padding8",px:"$padding12",..._.oO,onPress:()=>{m({...R.gU,protocolVersion:j,currencyInputs:{[D.I.TOKEN0]:ye.currency,[D.I.TOKEN1]:me.currency}}),f(x.EP),k(x.fR),g(R.C4.SELECT_TOKENS_AND_FEE_TIER)},children:[(0,r.jsx)(G.B,{color:"$neutral1",size:16}),(0,r.jsx)(Y.EY,{variant:"buttonLabel4",color:"$neutral2",children:(0,r.jsx)(O.Trans,{i18nKey:"common.button.reset"})})]})]}),(0,r.jsxs)(z.s,{row:!0,gap:32,width:"100%",children:[!de.xl&&(0,r.jsx)(z.s,{width:360,children:(0,r.jsx)(p.d,{steps:[{label:d("migrate.selectFeeTier"),active:h===R.C4.SELECT_TOKENS_AND_FEE_TIER},{label:d("migrate.setRange"),active:h===R.C4.PRICE_RANGE}]})}),(0,r.jsxs)(z.s,{gap:"$gap16",maxWidth:"calc(min(580px, 90vw))",children:[(0,r.jsx)(c.o,{liquidityPosition:e}),(0,r.jsx)(z.s,{justifyContent:"center",alignItems:"center",children:(0,r.jsx)(z.s,{shrink:!0,backgroundColor:"$surface2",borderRadius:"$rounded12",p:"$padding12",children:(0,r.jsx)(B.ArrowDown,{size:20,color:"$neutral1"})})}),h===R.C4.SELECT_TOKENS_AND_FEE_TIER?(0,r.jsx)(E.n,{width:"100%",maxWidth:"unset",tokensLocked:!0,onContinue:()=>{g(R.C4.PRICE_RANGE)}}):(0,r.jsx)(w.h,{width:"100%",maxWidth:"unset"}),h===R.C4.PRICE_RANGE&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.H,{width:"100%",maxWidth:"unset",onDisableContinue:!ce||ae,onContinue:()=>{var t;const o=(0,A.isValidLiquidityTxContext)(ce);ne&&(null===(t=ne)||void 0===t?void 0:t.type)===Z.AccountType.SignerMnemonic&&o&&se($.f.actions.trigger({selectChain:Q,startChainId:te,account:ne,liquidityTxContext:ce,setCurrentStep:U,setSteps:N,onSuccess:()=>{pe(),le("/positions")},onFailure:pe,analytics:{...(0,u.J)({trace:n,fee:e.feeTier,currency0:ye.currency,currency1:me.currency,currency0AmountUsd:ge,currency1AmountUsd:xe,poolId:e.poolId,version:j,chainId:te}),action:"V3->V4"}}))}}),ae&&(0,r.jsx)(q.O,{refetch:ue})]})]})]})]}),(0,r.jsxs)(X.Modal,{name:oe.ModalName.MigrateLiquidity,onClose:pe,isDismissible:!0,isModalOpen:Boolean(M),children:[(0,r.jsx)(s.R,{title:d("pool.migrateLiquidity"),closeModal:pe}),(0,r.jsxs)(z.s,{gap:"$gap16",px:"$padding16",my:"$spacing8",children:[(0,r.jsx)(a.Y,{currencyAmount:ye,currencyUSDAmount:ge}),(0,r.jsx)(Y.EY,{variant:"body3",color:"$neutral2",children:d("common.and")}),(0,r.jsx)(a.Y,{currencyAmount:me,currencyUSDAmount:xe})]}),(0,r.jsx)(W.ProgressIndicator,{steps:C,currentStep:M})]})]}):(0,r.jsx)(L.C5,{to:"/pools",replace:!0})}function ue(){var e;const{tokenId:t}=(0,L.g)(),o=(0,se.WB)(),i=(0,I.F)(),{data:s,isLoading:c}=(0,Q.b)(i.address?{owner:i.address,protocolVersion:n.ProtocolVersion.V3,tokenId:t,chainId:o??i.chainId}:void 0),a=null===(e=s)||void 0===e?void 0:e.position,u=(0,v.useMemo)((()=>(0,d.rL)(a)),[a]);if(c||!a||!u||u.version!==n.ProtocolVersion.V3)return(0,r.jsx)(ce,{children:(0,r.jsxs)(l.ar,{children:[(0,r.jsx)(N.FO,{}),(0,r.jsx)(N.FO,{}),(0,r.jsx)(N.FO,{}),(0,r.jsx)(N.FO,{}),(0,r.jsx)(N.FO,{}),(0,r.jsx)(N.FO,{}),(0,r.jsx)(N.FO,{}),(0,r.jsx)(N.FO,{}),(0,r.jsx)(N.FO,{}),(0,r.jsx)(N.FO,{}),(0,r.jsx)(N.FO,{})]})});const{currency0Amount:p,currency1Amount:y,feeTier:m}=u;return(0,r.jsx)(te.default,{logImpression:!0,page:oe.InterfacePageNameLocal.MigrateV3,properties:{pool_address:u.poolId,chain_id:o??i.chainId,label:[p.currency.symbol,y.currency.symbol].join("/"),fee_tier:m,token0Address:(0,ne.currencyIdToAddress)((0,ne.currencyId)(p.currency)),token1Address:(0,ne.currencyIdToAddress)((0,ne.currencyId)(y.currency))},children:(0,r.jsx)(C.Cy,{initialState:{currencyInputs:{[D.I.TOKEN0]:p.currency,[D.I.TOKEN1]:y.currency}},children:(0,r.jsx)(C.$A,{children:(0,r.jsx)(C.NM,{children:(0,r.jsx)(P,{positionInfo:u,children:(0,r.jsx)(ae,{positionInfo:u})})})})})})}}}]);
//# sourceMappingURL=6258.cfd9b53e.chunk.js.map